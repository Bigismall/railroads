var C=Object.defineProperty;var E=(n,t,e)=>t in n?C(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var c=(n,t,e)=>(E(n,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function e(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(s){if(s.ep)return;s.ep=!0;const a=e(s);fetch(s.href,a)}})();const h=document.querySelector.bind(document);document.querySelectorAll.bind(document);const P=180,w=P/Math.PI,g=1,f=-1,x="rail--active",y=(n,t)=>Math.sqrt(Math.pow(n.x-t.x,2)+Math.pow(n.y-t.y,2));class r{constructor(t="",e=!1){c(this,"$element");c(this,"active");c(this,"length");c(this,"start");c(this,"end");c(this,"_next",[]);c(this,"_prev",[]);const o=h(t);if(o===null)throw new Error(`No element found: ${t}`);this.$element=o,this.active=e,this.length=this.$element.getTotalLength();const s=this.$element.getPointAtLength(0),a=this.$element.getPointAtLength(this.length);this.start={x:s.x,y:s.y},this.end={x:a.x,y:a.y},this._next=[],this._prev=[],this.active&&this.$element.classList.add(x)}get nextActive(){return this._next.find(t=>t.active)}get prevActive(){return this._prev.find(t=>t.active)}static connect(t,e){t.addNext(e),e.addPrev(t)}static hit(t,e){t.addNext(e),e.addNext(t)}getPrevRail(){return this._prev.length===0?null:this._prev.length===1?this._prev[0]:this.prevActive??null}getNextRail(){return this._next.length===0?null:this._next.length===1?this._next[0]:this.nextActive??null}getNextDirection(t,e){const o=y(t.getOnCanvas().position,e.start),s=y(t.getOnCanvas().position,e.end);return o<s?g:f}addNext(t){this._next.push(t)}addPrev(t){this._prev.push(t)}}class p{constructor(t,e,o=0){c(this,"rails");c(this,"activeRail",0);this.rails=[t,e],this.activeRail=o,this.toggle(this.activeRail),this.rails.forEach(s=>{s.$element.addEventListener("click",()=>{this.toggle()})})}toggle(t){this.activeRail=t??(this.activeRail+1)%2,this.makeInactive(this.rails[1-this.activeRail]),this.makeActive(this.rails[this.activeRail])}makeActive(t){t.active=!0,t.$element.classList.add(x)}makeInactive(t){t.active=!1,t.$element.classList.remove(x)}}class R{constructor(t,e){c(this,"train");c(this,"rail");this.train=t,this.rail=e}gameLoop(){if(this.train.isMovingForward()){if(this.passedRail()){const t=this.rail.getNextRail();if(t===null)return;const e=this.rail.getNextDirection(this.train,t),o=e===g?0:t.length;this.train.setOnPath(e,o),this.rail=t}}else if(this.backOffRail()){const t=this.rail.getPrevRail();if(t===null)return;const e=this.rail.getNextDirection(this.train,t),o=e===g?0:t.length;this.train.setOnPath(e,o),this.rail=t}this.train.updatePosition(this.rail)}passedRail(){return this.train.getOnPath().position>=this.rail.length}backOffRail(){return this.train.getOnPath().position<=0}}const D=(n,t)=>P+w*Math.atan2(t.y-n.y,t.x-n.x),S=(n,t)=>w*Math.atan2(t.y-n.y,t.x-n.x),d=n=>{const t=h(".playground__container"),e=document.createElement("div"),o=n.$element.id;e.innerText=o;const s=y(n.start,n.end),a=S(n.start,n.end),l=n.end.x-n.start.x,v=n.end.y-n.start.y;console.log({label:o,start:{x:n.start.x,y:n.start.y},end:{x:n.end.x,y:n.end.y},width:l,height:v,dist:s,ang:a}),e.classList.add("rail__helper"),e.style.left=l>0?`${n.start.x}px`:`${n.end.x}px`,e.style.top=v>0?`${n.start.y}px`:`${n.end.y}px`,e.style.width=`${Math.abs(l)}px`,e.style.height=`${Math.abs(v)}px`,e.style.transform=`rotate(${a}deg)`,e.style.transformOrigin="center center",t==null||t.appendChild(e)},N=20,I=5;class L{constructor(t,e=1,o=0){c(this,"$element");c(this,"speed");c(this,"onPath");c(this,"onCanvas");if(t===null)throw new Error("No selector provided");this.$element=t,this.speed=e,this.onCanvas={position:{x:0,y:0},angle:0},this.onPath={position:o,direction:f}}isMovingForward(){return this.onPath.direction===g}isMovingBackward(){return!this.isMovingForward()}setOnPath(t,e){this.onPath={direction:t,position:e}}getOnPath(){return this.onPath}setOnCanvas(t,e){this.onCanvas={position:t,angle:e}}getOnCanvas(){return this.onCanvas}updatePosition(t){const e=t.$element.getPointAtLength(this.onPath.position),o=t.$element.getPointAtLength(this.onPath.position-1);this.setOnCanvas(e,D(o,e)),this.setCanvasValues(),this.move()}toggleDirection(){this.onPath.direction*=f}setSpeed(t){this.speed=t}getSpeed(){return this.speed}setCanvasValues(){this.$element.style.setProperty("--train-translate-x",`${this.onCanvas.position.x}px`),this.$element.style.setProperty("--train-translate-y",`${this.onCanvas.position.y}px`),this.$element.style.setProperty("--train-rotate",`${this.onCanvas.angle}deg`)}move(){this.onPath.position+=this.onPath.direction*this.speed}}class m extends R{constructor(e,o,s=1){const a=new L(e,o.train.getSpeed(),(N*2+I)*s);super(a,o.rail);c(this,"root");this.root=o}attachTo(e){this.root=e}gameLoop(){this.train.setSpeed(this.root.train.getSpeed()),super.gameLoop()}}class b extends L{}const $=String({}.VITE_DEBUG??"").toUpperCase()==="TRUE";console.log("DEBUG",$);const i=[new r("#rail1"),new r("#rail2",!0),new r("#rail4"),new r("#rail6"),new r("#rail7",!0),new r("#rail9",!0),new r("#rail11",!0),new r("#rail12"),new r("#rail13"),new r("#rail14")],A=h("#train-speed"),M=h("#train-direction");r.connect(i[0],i[1]);r.hit(i[0],i[9]);r.connect(i[1],i[2]);r.connect(i[1],i[4]);r.connect(i[2],i[3]);r.connect(i[3],i[0]);r.connect(i[4],i[5]);r.connect(i[4],i[7]);r.connect(i[5],i[6]);r.connect(i[6],i[0]);r.connect(i[7],i[8]);r.connect(i[8],i[9]);new p(i[1],i[9]);new p(i[2],i[4]);new p(i[5],i[7]);new p(i[3],i[6]);const u=new R(new b(h(".js-train-1"),A.valueAsNumber,0),i[0]),O=[new m(h(".js-car-1"),u,1),new m(h(".js-car-2"),u,2),new m(h(".js-car-3"),u,3)];A.addEventListener("change",n=>{u.train.setSpeed(n.target.valueAsNumber)});M.addEventListener("click",()=>{u.train.toggleDirection(),O.forEach(n=>{n.train.toggleDirection()})});$&&(d(i[0]),d(i[1]),d(i[2]),d(i[3]),d(i[6]),d(i[9]));const _=()=>{u.gameLoop(),O.forEach(n=>{n.gameLoop()}),requestAnimationFrame(_)};requestAnimationFrame(_);
