var E=Object.defineProperty;var D=(n,t,e)=>t in n?E(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var c=(n,t,e)=>D(n,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const h of a.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&r(h)}).observe(document,{childList:!0,subtree:!0});function e(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(s){if(s.ep)return;s.ep=!0;const a=e(s);fetch(s.href,a)}})();const l=document.querySelector.bind(document);document.querySelectorAll.bind(document);const w=180,R=w/Math.PI,g=1,f=-1,x="rail--active",S=(n,t)=>w+R*Math.atan2(t.y-n.y,t.x-n.x),N=(n,t)=>R*Math.atan2(t.y-n.y,t.x-n.x),y=(n,t)=>Math.abs(n.x-t.x)+Math.abs(n.y-t.y),d=n=>{const t=l(".playground__container"),e=document.createElement("div"),r=n.$element.id;e.innerText=r;const s=y(n.start,n.end),a=N(n.start,n.end),h=n.end.x-n.start.x,v=n.end.y-n.start.y;console.log({label:r,start:{x:n.start.x,y:n.start.y},end:{x:n.end.x,y:n.end.y},width:h,height:v,dist:s,ang:a}),e.classList.add("rail__helper"),e.style.left=h>0?`${n.start.x}px`:`${n.end.x}px`,e.style.top=v>0?`${n.start.y}px`:`${n.end.y}px`,e.style.width=`${Math.abs(h)}px`,e.style.height=`${Math.abs(v)}px`,e.style.transform=`rotate(${a}deg)`,e.style.transformOrigin="center center",t==null||t.appendChild(e)},b=20,I=5;class L{constructor(t,e=1,r=0){c(this,"$element");c(this,"speed");c(this,"onPath");c(this,"onCanvas");if(t===null)throw new Error("No selector provided");this.$element=t,this.speed=e,this.onCanvas={position:{x:0,y:0},angle:0},this.onPath={position:r,direction:f}}isMovingForward(){return this.onPath.direction===g}isMovingBackward(){return!this.isMovingForward()}setOnPath(t,e){this.onPath={direction:t,position:e}}getOnPath(){return this.onPath}setOnCanvas(t,e){this.onCanvas={position:t,angle:e}}getOnCanvas(){return this.onCanvas}updatePosition(t){const e=t.$element.getPointAtLength(this.onPath.position),r=t.$element.getPointAtLength(this.onPath.position-1);this.setOnCanvas(e,S(r,e)),this.setCanvasValues(),this.move()}toggleDirection(){this.onPath.direction*=f}setSpeed(t){this.speed=t}getSpeed(){return this.speed}setCanvasValues(){this.$element.style.setProperty("--train-translate-x",`${this.onCanvas.position.x}px`),this.$element.style.setProperty("--train-translate-y",`${this.onCanvas.position.y}px`),this.$element.style.setProperty("--train-rotate",`${this.onCanvas.angle}deg`)}move(){this.onPath.position+=this.onPath.direction*this.speed}}class M extends L{}class o{constructor(t="",e=!1){c(this,"$element");c(this,"active");c(this,"length");c(this,"start");c(this,"end");c(this,"_next",[]);c(this,"_prev",[]);const r=l(t);if(r===null)throw new Error(`No element found: ${t}`);this.$element=r,this.active=e,this.length=this.$element.getTotalLength();const s=this.$element.getPointAtLength(0),a=this.$element.getPointAtLength(this.length);this.start={x:s.x,y:s.y},this.end={x:a.x,y:a.y},this._next=[],this._prev=[],this.active&&this.$element.classList.add(x)}get nextActive(){return this._next.find(t=>t.active)}get prevActive(){return this._prev.find(t=>t.active)}static connect(t,e){t.addNext(e),e.addPrev(t)}static hit(t,e){t.addNext(e),e.addNext(t)}getPrevRail(){return this._prev.length===0?null:this._prev.length===1?this._prev[0]:this.prevActive??null}getNextRail(){return this._next.length===0?null:this._next.length===1?this._next[0]:this.nextActive??null}getNextDirection(t,e){const r=y(t.getOnCanvas().position,e.start),s=y(t.getOnCanvas().position,e.end);return r<s?g:f}addNext(t){this._next.push(t)}addPrev(t){this._prev.push(t)}}class ${constructor(t,e){c(this,"train");c(this,"rail");this.train=t,this.rail=e}gameLoop(){if(this.train.isMovingForward()){if(this.passedRail()){const t=this.rail.getNextRail();if(t===null)return;const e=this.rail.getNextDirection(this.train,t),r=e===g?0:t.length;this.train.setOnPath(e,r),this.rail=t}}else if(this.backOffRail()){const t=this.rail.getPrevRail();if(t===null)return;const e=this.rail.getNextDirection(this.train,t),r=e===g?0:t.length;this.train.setOnPath(e,r),this.rail=t}this.train.updatePosition(this.rail)}passedRail(){return this.train.getOnPath().position>=this.rail.length}backOffRail(){return this.train.getOnPath().position<=0}}class m extends ${constructor(e,r,s=1){const a=new L(e,r.train.getSpeed(),(b*2+I)*s);super(a,r.rail);c(this,"root");this.root=r}attachTo(e){this.root=e}gameLoop(){this.train.setSpeed(this.root.train.getSpeed()),super.gameLoop()}}class p{constructor(t,e,r=0){c(this,"rails");c(this,"activeRail",0);this.rails=[t,e],this.activeRail=r,this.toggle(this.activeRail);for(const s of this.rails)s.$element.addEventListener("click",()=>{this.toggle()})}toggle(t){this.activeRail=t??(this.activeRail+1)%2,this.makeInactive(this.rails[1-this.activeRail]),this.makeActive(this.rails[this.activeRail])}makeActive(t){t.active=!0,t.$element.classList.add(x)}makeInactive(t){t.active=!1,t.$element.classList.remove(x)}}const A="".toUpperCase()==="TRUE";console.log("DEBUG",A);const i=[new o("#rail1"),new o("#rail2",!0),new o("#rail4"),new o("#rail6"),new o("#rail7",!0),new o("#rail9",!0),new o("#rail11",!0),new o("#rail12"),new o("#rail13"),new o("#rail14")],P=l("#train-speed")??null,O=l("#train-direction")??null;if(!P||!O)throw new Error("Missing train-speed or train-direction element");o.connect(i[0],i[1]);o.hit(i[0],i[9]);o.connect(i[1],i[2]);o.connect(i[1],i[4]);o.connect(i[2],i[3]);o.connect(i[3],i[0]);o.connect(i[4],i[5]);o.connect(i[4],i[7]);o.connect(i[5],i[6]);o.connect(i[6],i[0]);o.connect(i[7],i[8]);o.connect(i[8],i[9]);new p(i[1],i[9]);new p(i[2],i[4]);new p(i[5],i[7]);new p(i[3],i[6]);const u=new $(new M(l(".js-train-1"),P.valueAsNumber,0),i[0]),_=[new m(l(".js-car-1"),u,1),new m(l(".js-car-2"),u,2),new m(l(".js-car-3"),u,3)];P.addEventListener("change",n=>{u.train.setSpeed(n.target.valueAsNumber)});O.addEventListener("click",()=>{u.train.toggleDirection();for(const n of _)n.train.toggleDirection()});A&&(d(i[0]),d(i[1]),d(i[2]),d(i[3]),d(i[6]),d(i[9]));const C=()=>{u.gameLoop();for(const n of _)n.gameLoop();requestAnimationFrame(C)};requestAnimationFrame(C);
