var C=Object.defineProperty;var E=(n,t,e)=>t in n?C(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var r=(n,t,e)=>(E(n,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const c of s)if(c.type==="childList")for(const l of c.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&a(l)}).observe(document,{childList:!0,subtree:!0});function e(s){const c={};return s.integrity&&(c.integrity=s.integrity),s.referrerPolicy&&(c.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?c.credentials="include":s.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function a(s){if(s.ep)return;s.ep=!0;const c=e(s);fetch(s.href,c)}})();const h=document.querySelector.bind(document);document.querySelectorAll.bind(document);const P=180,R=P/Math.PI,g=1,x=-1,f="rail--active",y=(n,t)=>Math.sqrt(Math.pow(n.x-t.x,2)+Math.pow(n.y-t.y,2));class o{constructor(t="",e=!1){r(this,"$element");r(this,"active");r(this,"length");r(this,"start");r(this,"end");r(this,"_next",[]);r(this,"_prev",[]);this.$element=h(t),this.active=e,this.length=this.$element?this.$element.getTotalLength():0;const a=this.$element.getPointAtLength(0),s=this.$element.getPointAtLength(this.length);this.start={x:a.x,y:a.y},this.end={x:s.x,y:s.y},this._next=[],this._prev=[],this.active&&this.$element.classList.add(f)}get nextActive(){return this._next.find(t=>t.active)}get prevActive(){return this._prev.find(t=>t.active)}static connect(t,e){t.addNext(e),e.addPrev(t)}static hit(t,e){t.addNext(e),e.addNext(t)}getPrevRail(){return this._prev.length===1?this._prev[0]:this.prevActive||null}getNextRail(){return this._next.length===1?this._next[0]:this.nextActive||null}getNextDirection(t,e){const a=y(t.getOnCanvas().position,e.start),s=y(t.getOnCanvas().position,e.end);return a<s?g:x}addNext(t){this._next.push(t)}addPrev(t){this._prev.push(t)}}class u{constructor(t,e,a=0){r(this,"rails");r(this,"activeRail",0);this.rails=[t,e],this.activeRail=a,this.toggle(this.activeRail),this.rails.forEach(s=>{s.$element.addEventListener("click",()=>this.toggle())})}toggle(t){this.activeRail=t??(this.activeRail+1)%2,this.makeInactive(this.rails[1-this.activeRail]),this.makeActive(this.rails[this.activeRail])}makeActive(t){t.active=!0,t.$element.classList.add(f)}makeInactive(t){t.active=!1,t.$element.classList.remove(f)}}class w{constructor(t,e){r(this,"train");r(this,"rail");this.train=t,this.rail=e}gameLoop(){if(this.train.isMovingForward()){if(this.passedRail()){const t=this.rail.getNextRail();if(!t)return;const e=this.rail.getNextDirection(this.train,t),a=e===g?0:t.length;this.train.setOnPath(e,a),this.rail=t}}else if(this.backOffRail()){const t=this.rail.getPrevRail();if(!t)return;const e=this.rail.getNextDirection(this.train,t),a=e===g?0:t.length;this.train.setOnPath(e,a),this.rail=t}this.train.updatePosition(this.rail)}passedRail(){return this.train.getOnPath().position>=this.rail.length}backOffRail(){return this.train.getOnPath().position<=0}}const D=(n,t)=>P+R*Math.atan2(t.y-n.y,t.x-n.x),S=(n,t)=>R*Math.atan2(t.y-n.y,t.x-n.x),d=n=>{const t=h(".playground__container"),e=document.createElement("div"),a=n.$element.id;e.innerText=a;const s=y(n.start,n.end),c=S(n.start,n.end),l=n.end.x-n.start.x,v=n.end.y-n.start.y;console.log({label:a,start:{x:n.start.x,y:n.start.y},end:{x:n.end.x,y:n.end.y},width:l,height:v,dist:s,ang:c}),e.classList.add("rail__helper"),e.style.left=l>0?`${n.start.x}px`:`${n.end.x}px`,e.style.top=v>0?`${n.start.y}px`:`${n.end.y}px`,e.style.width=`${Math.abs(l)}px`,e.style.height=`${Math.abs(v)}px`,e.style.transform=`rotate(${c}deg)`,e.style.transformOrigin="center center",t==null||t.appendChild(e)},N=20,I=5;class L{constructor(t,e=1,a=0){r(this,"$element");r(this,"speed");r(this,"onPath");r(this,"onCanvas");if(!t)throw new Error("No selector provided");this.$element=t,this.speed=e,this.onCanvas={position:{x:0,y:0},angle:0},this.onPath={position:a,direction:x}}isMovingForward(){return this.onPath.direction===g}isMovingBackward(){return!this.isMovingForward()}setOnPath(t,e){this.onPath={direction:t,position:e}}getOnPath(){return this.onPath}setOnCanvas(t,e){this.onCanvas={position:t,angle:e}}getOnCanvas(){return this.onCanvas}updatePosition(t){const e=t.$element.getPointAtLength(this.onPath.position),a=t.$element.getPointAtLength(this.onPath.position-1);this.setOnCanvas(e,D(a,e)),this.setCanvasValues(),this.move()}toggleDirection(){this.onPath.direction*=x}setSpeed(t){this.speed=t}getSpeed(){return this.speed}setCanvasValues(){this.$element.style.setProperty("--train-translate-x",`${this.onCanvas.position.x}px`),this.$element.style.setProperty("--train-translate-y",`${this.onCanvas.position.y}px`),this.$element.style.setProperty("--train-rotate",`${this.onCanvas.angle}deg`)}move(){this.onPath.position+=this.onPath.direction*this.speed}}class m extends w{constructor(e,a,s=1){const c=new L(e,a.train.getSpeed(),(N*2+I)*s);super(c,a.rail);r(this,"root");this.root=a}attachTo(e){this.root=e}gameLoop(){this.train.setSpeed(this.root.train.getSpeed()),super.gameLoop()}}class b extends L{}const $=String({}.VITE_DEBUG??"").toUpperCase()==="TRUE";console.log("DEBUG",$);const i=[new o("#rail1"),new o("#rail2",!0),new o("#rail4"),new o("#rail6"),new o("#rail7",!0),new o("#rail9",!0),new o("#rail11",!0),new o("#rail12"),new o("#rail13"),new o("#rail14")],A=h("#train-speed"),M=h("#train-direction");o.connect(i[0],i[1]);o.hit(i[0],i[9]);o.connect(i[1],i[2]);o.connect(i[1],i[4]);o.connect(i[2],i[3]);o.connect(i[3],i[0]);o.connect(i[4],i[5]);o.connect(i[4],i[7]);o.connect(i[5],i[6]);o.connect(i[6],i[0]);o.connect(i[7],i[8]);o.connect(i[8],i[9]);new u(i[1],i[9]);new u(i[2],i[4]);new u(i[5],i[7]);new u(i[3],i[6]);const p=new w(new b(h(".js-train-1"),A.valueAsNumber,0),i[0]),O=[new m(h(".js-car-1"),p,1),new m(h(".js-car-2"),p,2),new m(h(".js-car-3"),p,3)];A.addEventListener("change",n=>{p.train.setSpeed(n.target.valueAsNumber)});M.addEventListener("click",()=>{p.train.toggleDirection(),O.forEach(n=>n.train.toggleDirection())});$&&(d(i[0]),d(i[1]),d(i[2]),d(i[3]),d(i[6]),d(i[9]));function _(){p.gameLoop(),O.forEach(n=>n.gameLoop()),requestAnimationFrame(_)}requestAnimationFrame(_);
